---
title: "网络协议"
linkTitle: "网络协议"
weight: 1
description: >
  网络协议
---



tcp：
  流量控制
  超时重传
  拥塞控制

传输层的数据包大小超过 **MSS (TCP最大报文段长度)**，就要将数据分块，这样即使中途有一个分块出问题，只需要重传这个分块，而不用重新发送整个数据包。
在 TCP 协议中，每个分块称为 **TCP段**。



网络层最常用的是IP协议，将传输层的报文作为数据部分，再加上IP包头组装成IP报文，如果报文大小超过 **MTU**（以太网中一般为1500字节）就会再次进行分片，得到一个即将发送到网络的IP报文。


IP地址分成的两种意义：
- 一是**网络号**，负责标识该IP地址是属于哪个【子网】；
- 二是**主机号**，负责标识同一【子网】下的不同主机；


需要配合**子网掩码**才能计算出 IP地址的网络号和主机号。
如： 10.100.122.0/24  /24就是 255.255.255.0 子网掩码，二进制有24个1.

- 计算网络号： 将IP与子网掩码做 AND 运算
- 计算主机号： 将子网掩码取反后与IP地址进行与运算



网络接口层：
生成了 IP 头部之后，接下来要交给 网络接口层 在 IP 头部的前面加上 MAC 头部，并封装成数据帧发送到网络上。


## 可靠传输 TCP
TCP报文头部格式：
- 源端口号    ：确认应用
- 目的端口号  ：确认目的应用
- 序号        ：解决包乱序问题
- 确认序号    ：确认发出去对方是否收到，没收到就重新发送，解决丢包问题
- 状态位      ：SYN（发起一个连接）  ACK（回复）  RST（重新连接） FIN（结束连接），带有状态位的包的发送，引起双方状态变更。
- 首部长度    ：
- 保留
- 校验
- 窗口大小    ： TCP要控制流量，通信双方个声明一个窗口（缓存大小），表示当前处理的能力。还要拥塞控制，控制发送的速度。
- 紧急指针
- 选项


## 网络包 IP
IP 报文头部：
- 版本
- 首部长度
- 服务类型
- 协议  ： http通过tcp传输，填写 06，表示协议为tcp
- 校验
- ttl
- 源 IP 地址   ：客户端输出的IP地址
- 目标 IP 地址 : web 服务器 IP


## MAC
MAC 头部：
- 接收方 MAC 地址
- 发送方 MAC 地址
- 协议类型        ：IP协议和 ARP协议



HTTP1.0 
无状态、无连接 

HTTP1.1 
持久连接 请求管道化 增加缓存处理（新的字段如cache-control） 增加Host字段、支持断点传输等 



HTTP2.0 
二进制分帧 多路复用（或连接共享） 头部压缩 服务器推送



## HTTPS 优化：
tls协议，目的是为了通过非对称加密握手协商或者交换出对称加密密钥。


尽量序言用 ECDHE 密钥交换算法替代 RSA 算法，使用 tls1.3 （简化了握手的步骤，握手只要1RTT）

证书优化

会话复用



SYN  seq = clinet_isn


ACK = seq + 1
SEQ = server_isn

ACK = server_isn + 1


三次握手建立连接的主要原因是**防止历史连接 初始化了连接。**



